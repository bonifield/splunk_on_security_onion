# VIEW FIELDS
sourcetype=bro_dce_rpc | fields - date* punct splunk_* | fieldsummary | fields field values

# QUERIES

# internal only
| where cidrmatch("10.0.0.0/8", src_ip) AND cidrmatch("10.0.0.0/8", dest_ip)
in token - &quot;

# first hits
| stats sparkline(count) AS trend, earliest(_time) AS first_hit, latest(_time) AS latest_hit, count by FIELD-GOES-HERE | eval first_hit=strftime(first_hit, "%x %X"), latest_hit=strftime(latest_hit, "%x %X"), hide = "&#8856;"

# bro_conn
sourcetype=bro_conn | fillnull value=- | table _time uid proto service src_ip dest_ip src_port dest_port conn_state conn_state_description history 
orig_bytes resp_bytes orig_ip_bytes resp_ip_bytes orig_pkts resp_pkts missed_bytes | sort -_time

# bro_capture_loss
sourcetype=bro_capture_loss | fillnull value=- | table _time acks gaps peer percent_lost ts_delta | sort -percent_lost



# counts by host
sourcetype=bro_dns | stats values(query) as query, dc(query) as distinct, count(query) as total by src_ip | sort -total
# query stats by query
sourcetype=bro_dns | eval len_query = len(query) | stats min(len_query) as len_min, max(len_query) as len_max, median(len_query) as len_median, mode(len_query) as len_mode, count(query) as count by query
# query stats by src_ip
sourcetype=bro_dns | eval len_query = len(query) | stats min(len_query) as query_len_min, max(len_query) as query_len_max, median(len_query) as query_len_median, mode(len_query) as query_len_mode, count(query) as query_count by src_ip
 | eval logged_timestamp = strftime(now(), "%x %X") | table logged_timestamp

# time between requests by host with logged time
sourcetype=bro_dns | eval ctime = _time | sort 0 +ctime | streamstats global=f window=2 current=f last(ctime) as prev_time by src_ip | eval diff = ctime - prev_time | eval [| makeresults | eval logged_timestamp = strftime(now(), "%x %X") | return logged_timestamp]  | table logged_timestamp src_ip ctime prev_time diff

# query stats by src_ip with logged time
sourcetype=bro_dns | eval len_query = len(query), simple_date = strftime(_time, "%F") | stats min(len_query) as query_len_min, max(len_query) as query_len_max, median(len_query) as query_len_median, mode(len_query) as query_len_mode, count(query) as query_count by src_ip | eval [| makeresults | eval logged_timestamp = strftime(now(), "%x %X") | return logged_timestamp] | table logged_timestamp src_ip query_len_min query_len_max query_len_median query_len_mode query_count



# bro_dce_rpc
sourcetype=bro_dce_rpc | fillnull value=- | table _time ts uid src_ip dest_ip src_port dest_port endpoint named_pipe operation rtt | sort -_time

# bro_dns
sourcetype=bro_dns | fillnull value=- | table _time uid proto src_ip dest_ip src_port dest_port qtype_name query answers auth addl rcode_name rejected rtt qclass qclass_name qtype rcode AA TC RD RA Z | sort -_time

# bro_dpd
sourcetype=bro_dpd | fillnull value=- | table _time uid proto analyzer src_ip dest_ip src_port dest_port failure_reason | sort -_time

# bro_files
sourcetype=bro_files | fillnull value=- | table _time conn_uids fuid src_ip dest_ip is_orig local_orig mime_type analyzers depth duration filename extracted missing_bytes overflow_bytes seen_bytes total_bytes md5 sha1 | sort -_time

# bro_ftp
sourcetype=bro_ftp | fillnull value=- | table _time uid user command reply_code reply_msg mime_type arg file_size src_ip dest_ip src_port dest_port data_channel_src_ip data_channel_dest_ip data_channel_dest_port data_channel_passive fuid | sort -_time

# bro_http
sourcetype=bro_http | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port method status_code status_msg host uri user_agent referrer version proxied orig_mime_types resp_mime_types orig_filenames resp_filenames orig_fuids resp_fuids request_body_len response_body_len info_code info_msg | sort -_time

# bro_irc
sourcetype=bro_irc | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port nick user command dcc_file_name dcc_file_size value | sort -_time

# bro_kerberos
sourcetype=bro_kerberos | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port service request_type kerberos_success error_msg client client_cert_subject server_cert_subject email_from forwardable renewable cipher client_cert_fuid server_cert_fuid valid_until | sort -_time

# bro_mysql
sourcetype=bro_mysql | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port mysql_success mysql_command mysql_arg response rows | sort -_time

# bro_notice
sourcetype=bro_notice | fillnull value=- | table _time uid proto src_ip dest_ip src_port dest_port peer_descr dropped note msg sub | sort -_time

# bro_rdp
sourcetype=bro_rdp | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port result client_name cert_type cert_count cert_permanent client_build client_digital_product_id desktop_height desktop_width encryption_level encryption_method keyboard_layout requested_color_depth | sort -_time

# bro_sip
sourcetype=bro_sip | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port call_id method request_from response_to request_path response_path seq status_code status_msg uri user_agent content_type warning request_body_len response_body_len | sort -_time

# bro_smb_files
sourcetype=bro_smb_files | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port action name path size times_accessed times_changed times_created times_modified | sort -_time

# bro_smb_mapping
sourcetype=bro_smb_mapping | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port service share_type path native_file_system | sort -_time

# bro_smtp
sourcetype=bro_smtp | fillnull value=- | table _time uid from to cc recipient_to subject helo last_reply tls user_agent reply_to in_reply_to x_originating_ip first_received second_received path is_webmail src_ip dest_ip src_port dest_port | sort -_time

# bro_snmp
sourcetype=bro_snmp | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port community display_string duration version get_bulk_requests get_requests get_responses set_requests up_since | sort -_time

# bro_socks
sourcetype=bro_socks | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port user server_status bound_host bound_port request_host request_port request_name version | sort -_time

# bro_software
sourcetype=bro_software | fillnull value=- | table _time src_ip src_port name software_type unparsed_version version_major version_minor version_minor2 version_minor3 version_additional_info | sort -_time

# bro_ssh
sourcetype=bro_ssh | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port client server auth_attempts hassh hasshServer host_key cipher_alg compression_alg cshka hasshAlgorithms hasshServerAlgorithms hasshVersion host_key_alg kex_alg ma_alg sshka version | sort -_time

# bro_ssl
sourcetype=bro_ssl | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port version validation_status subject issuer established resumed ja3 ja3s curve cert_chain_fuids client_cert_chain_fuids | sort -_time
| stats count by validation_status

# bro_tunnel
sourcetype=bro_tunnel | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port action tunnel_type | sort -_time

# bro_weird
sourcetype=bro_weird | fillnull value=- | table _time uid src_ip dest_ip src_port dest_port notice name peer | sort -_time





# bro_known_certs
bro_known_certs

# bro_known_hosts
sourcetype=bro_known_hosts

# bro_known_services
sourcetype=bro_known_services

# bro_known_entities
bro_known_entities
